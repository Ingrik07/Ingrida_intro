### Hello, I am Ingrida!

<p <img align="right">
 <source media="(prefers-color-scheme: dark)" srcset="https://github.com/Ingrik07/Ingrida_intro/blob/main/Screenshot%202024-06-28%20at%2015.39.05.png" width="30%" height="30%">
 <source media="(prefers-color-scheme: light)" srcset="https://github.com/Ingrik07/Ingrida_intro/blob/main/Screenshot%202024-06-28%20at%2015.39.05.png">
 <img alt="See-my-image" src="https://github.com/Ingrik07/Ingrida_intro/blob/main/Screenshot%202024-06-28%20at%2015.39.05.png"/>
 ### Get to know more about me: 
- üñ•Ô∏è I‚Äôm currently working as Influencersmarketing specialist.
- üå± I‚Äôm currently learning Data Analytics.
- üìà I‚Äôm looking to collaborate data analytics projects.
- üì∏ Photography is my passion.
- üèä‚Äç‚ôÄÔ∏è I like swimming.
- ‚ö° Fun fact: I also hold MA degree in Political science and European studies field.
- Constantly seeking for improvements in my carreer and daily life.
 
</picture>
 <h3 align="right"> ‚úâÔ∏èContact me </h3></p>
 <p align="right">
  <a href="https://www.linkedin.com/in/ingrida-ivinskait%C4%97-08b5837b/" target="_blank"> <img src="https://pngimg.com/uploads/linkedIn/linkedIn_PNG31.png" alt="html5" width="85" height="35"/a> <a href="mailto:ingrik0713@gmail.com"> <img align="right" alt="Gmail" width="120" hight="40" src="https://github.com/Xx-Ashutosh-xX/Xx-Ashutosh-xX/blob/master/assets/icons/gmail.png" width="100" height="40"/>
     </p>
  </p>

<details><summary><h2 align="left">üìú Table of Contents</h2></summary>

- [My skills](#My_skills)
- [Spreadsheets/Excel](#Spreadsheets/Excel)
- [Completed tasks](#Completed_tasks)
- [Spreadsheets/Excel](#Spreadsheets/Excel)
- [Power_BI](#Power_BI)
- [Big Query/SQL](#Big_Query/SQL)
- [Jupyter Notebook](In progress...)
- More about me (to be added)
</details>

## My Skills
<details>
<summary><h4 align="left">:hammer_and_wrench: Tools I use:</h4></summary>
<p align="left">
    <a href="https://console.cloud.google.com/bigquery" target="_blank"> <img src="https://w7.pngwing.com/pngs/182/372/png-transparent-google-bigquery-hd-logo.png" alt="css3" width="40" height="40"/> </a>
<a href="https://workspace.google.com/products/sheets" target="_blank"> <img src="https://logodix.com/logo/1842250.jpg" alt="sass" width="40" height="40"/> </a>
<a href="https://app.powerbi.com/home" target="_blank"> <img src="https://www.ptr.co.uk/sites/default/files/powerbilogo.png" alt="webpack" width="50" height="40"/> </a>
<a href="https://www.mysql.com/" target="_blank"> <img src="https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Ftse4.mm.bing.net%2Fth%3Fid%3DOIP.urLHYMYPFxkcs6AC4Io9vwHaHa%26pid%3DApi&f=1&ipt=71efdcecfa2727de604a484cb7c65e6b0ad68511d8ee20060b81dd649b8dfeba&ipo=images" alt="react" width="40" height="40"/> </a>
<a href="https://looker.com/" target="_blank"> <img src="https://saasrank.es/wp-content/uploads/2022/08/Looker-logo.jpg" alt="gatsby" width="40" height="40"/> </a>
    <a href="https://www.mongodb.com/" target="_blank"> <img src="https://raw.githubusercontent.com/devicons/devicon/master/icons/mongodb/mongodb-original-wordmark.svg" alt="mongodb" width="40" height="40"/> </a>
 <a href="https://workspace.google.com/" target="_blank"> <img src="https://images.squarespace-cdn.com/content/v1/540f5515e4b06c4e8629c108/1602589192895-NWQYFQV5AZ69KPSVTBR2/google-workspace-logo.png" alt="google cloud" width="80" height="40"/> </a>
    </p>
</details>

 <details>
  <summary><h4 align="left"> ü§ì Analytical and field skills </h4></summary>
<p align="center">
 
|  | Skills |
|-----:|---------------|
|     1|üéØ Finding and presenting OKRs |
|     2|üó®Ô∏è Answering advanced marketing questions |
|     3|üÜé A/B testing |
|     4|üìä Funnels analysis |
|     5|üï¥Ô∏èüí∞ RFM and Customer life time value (CLV) analysis |
|     6|üìà Interactive dashboards for reports |
|     7|üìú Marketing and politics research papers |

</p></details>

## Completed tasks (grouped by tool)
<details>
<summary><h2 href="https://workspace.google.com/" target="_blank"> <img src="https://logodix.com/logo/1842250.jpg" alt="spreadsheet" width="40" height="40"/>  Spreadsheets/Excel </h2></summary>
<details>
<summary><a href="https://docs.google.com/spreadsheets/d/1EXAIpX7G6SyWvEQi6TA0AJnb4wjip7a564iDOeVHEmU/edit?gid=1815364512#gid=1815364512" target="_blank"> <img src="https://logodix.com/logo/1842250.jpg" alt="css3" width="20" height="20"/> </a>   Retention cohorts analysis</summary>

---
> TASK:
> - You got a follow up task from your product manager to give stats on how subscriptions churn looks like from a weekly retention standpoint. Your PM argues that to view retention numbers on a monthly basis takes too long and important insights from data might be missed out.
> - You remember learning previously that cohorts analysis can be really helpful in such cases. You should provide weekly subscriptions data that shows how many subscribers started their subscription in a particular week and how many remain active in the following 6 weeks. Your end result should show weekly retention cohorts for each week of data available in the dataset and their retention from week 0 to week 6.

 <a href="https://firebase.google.com/" target="_blank"> <img src="https://github.com/Ingrik07/Ingrida_intro/blob/main/Logos/Screenshot%202024-06-30%20at%2013.12.04.png" alt="spreadsheet" width="487" height="370"/> </a>
</details>

<details>
<summary><a href="https://docs.google.com/spreadsheets/d/1WF-oJQxA0kmPitfOLe5lV9f5hUh_1bCNDzwgg7yfI50/edit?gid=409644485#gid=409644485" target="_blank"> <img src="https://logodix.com/logo/1842250.jpg" alt="spreadsheet" width="20" height="20"/> </a>   Funnels & A/B Tests</summary>

---
> TASK:
> - Your task is to build useful funnel chart from raw_events table data.
> - 1. Analyze the data in raw_events table. Spend time querying the table, getting more familiar with data. Identify events captured by users visiting the website.
> - 2. Now that you have your unique events table create a sales funnel chart from events in it. Not all events are relevant, productive to be used in this chart. Identify & collect data that you think could be used
> - Create a table showing the numbers of events' that you want to use in the funnel analysis. Add event_order and  the percentage drop off values, as in the Example:

 <a href="https://docs.google.com/spreadsheets/d/1WF-oJQxA0kmPitfOLe5lV9f5hUh_1bCNDzwgg7yfI50/edit?gid=409644485#gid=409644485" target="_blank"> <img src="https://github.com/Ingrik07/Ingrida_intro/blob/main/Logos/Screenshot%202024-06-30%20at%2013.46.33.png" alt="spreadsheet" width="850" height="500"/> </a>
</details>

<details>
<summary><a href="https://docs.google.com/spreadsheets/d/1mXkR2ZgxV15nFy-baiwhZq2UzaSvLFK00_VBCH_QQLo/edit?gid=1936416450#gid=1936416450" target="_blank"> <img src="https://logodix.com/logo/1842250.jpg" alt="spreadsheet" width="20" height="20"/> </a> Sales analysis on Spreadsheet</summary>

---
> TASK:
> You've been tasked to populate the 'Overview' sheet with analytical insight:
> 1. Business would like to see the monthly sales trend.
> 2. They would also like to evaluate online vs non-online orders.
>   
>    It would be nice for business to have an overview of:
>    1. The delivery performance trend (orderdate & Shipdate lag)
>    2. Top salesperson by sales, by volume.
>    3. Top countries.
>    4. Top sales reasons
>    5. Maybe you have an idea for business what could be interesting to look into from this data?

 <a href="https://docs.google.com/spreadsheets/d/1mXkR2ZgxV15nFy-baiwhZq2UzaSvLFK00_VBCH_QQLo/edit?gid=141689769#gid=141689769" target="_blank"> <img src="https://github.com/Ingrik07/Ingrida_intro/blob/main/Logos/Screenshot%202024-06-30%20at%2014.01.52.png" alt="spreadsheet" width="900" height="300"/> </a>
</details>
</details>

<details>
 <summary><h2 href="https://github.com/Ingrik07/Ingrida_intro/blob/main/PowerBI/Graded%20Task%20-%20Ingrida.pbit" target="_blank"> <img src="https://www.ptr.co.uk/sites/default/files/powerbilogo.png" alt="powerbi" width="40" height="40"/> Power BI </h2></summary>

<details>
 <summary><a href="https://app.powerbi.com/home" target="_blank"> <img src="https://www.ptr.co.uk/sites/default/files/powerbilogo.png" alt="webpack" width="20" height="20"/> </a>Data visualising with Power BI </summary>
 Click on the image below for Power BI file
 
 <a href="https://github.com/Ingrik07/Ingrida_intro/blob/main/PowerBI/Graded%20Task%20-%20Ingrida.pbit" target="_blank"> <img src="https://github.com/Ingrik07/Ingrida_intro/blob/main/Logos/sales%20power%20bi.JPG" alt="spreadsheet" width="712" height="798"/> </a>
</details>

<details>
 <summary><a href="https://github.com/Ingrik07/Ingrida_intro/blob/main/PowerBI/rfm_analysis.%20Ingrida%20Ivinskaite.pbix" target="_blank"> <img src="https://www.ptr.co.uk/sites/default/files/powerbilogo.png" alt="webpack" width="20" height="20"/> </a>RFM analysis </summary>

Power BI file [HERE]( https://github.com/Ingrik07/Ingrida_intro/blob/main/PowerBI/rfm_analysis.%20Ingrida%20Ivinskaite.pbix)

<a href="https://github.com/Ingrik07/Ingrida_intro/blob/main/PowerBI/rfm_analysis.%20Ingrida%20Ivinskaite.pbix" target="_blank"> <img src="https://github.com/Ingrik07/Ingrida_intro/blob/main/Logos/RFM%20power%20bi.JPG" alt="powerbi" width="518" height="815"/> </a>
</details>
</details>

<details> <summary><h2 href="https://console.cloud.google.com/" target="_blank"> <img src="https://w7.pngwing.com/pngs/182/372/png-transparent-google-bigquery-hd-logo.png" alt="css3" width="30" height="30"/>  Big Query/SQL</h2></summary>

<details>
<summary><a href="https://console.cloud.google.com/bigquery?sq=147855269776:a9a7016a5d384587b29dedab17b22b67" target="_blank"> <img src="https://w7.pngwing.com/pngs/182/372/png-transparent-google-bigquery-hd-logo.png" alt="css3" width="20" height="20"/> </a>  Big Query Customer life time value calculation example</summary>

---
> TASK: As the first step you should write 1 or 2 queries to pull data of weekly revenue divided by registrations.
> Since in this particular site there is no concept of registration, we will simply use the first visit to our website as registration date (registration cohort).
> 
```
WITH
  cohort_weeks AS ( --defining the cohort weeks
  SELECT
    user_pseudo_id AS user_id,
    MIN(DATE_TRUNC(PARSE_DATE('%Y%m%d', CAST(event_date AS String)), WEEK)) AS cohort_week
  FROM
    `tc-da-1.turing_data_analytics.raw_events`
  GROUP BY
    user_pseudo_id),

  sum_rev AS ( --defining the revenue
  SELECT
    user_pseudo_id AS user_id,
    purchase_revenue_in_usd AS revenue,
    DATE_TRUNC(PARSE_DATE('%Y%m%d', event_date), WEEK) AS purchase_week
  FROM
    `tc-da-1.turing_data_analytics.raw_events` )

SELECT 
  w.cohort_week,
  ROUND(SUM(
      CASE
        WHEN purchase_week = cohort_week THEN revenue
    END
      ) / COUNT(DISTINCT w.user_id), 4) AS week_0,
  ROUND(SUM(
      CASE
        WHEN purchase_week = DATE_ADD(cohort_week, INTERVAL 1 week) THEN revenue
    END
      ) / COUNT(DISTINCT w.user_id), 4) AS week_1,
  ROUND(SUM(
      CASE
        WHEN purchase_week = DATE_ADD(cohort_week, INTERVAL 2 week) THEN revenue
    END
      ) / COUNT(DISTINCT w.user_id), 4) AS week_2,
  ROUND(SUM(
      CASE
        WHEN purchase_week = DATE_ADD(cohort_week, INTERVAL 3 week) THEN revenue
    END
      ) / COUNT(DISTINCT w.user_id), 4) AS week_3,
  ROUND(SUM(
      CASE
        WHEN purchase_week = DATE_ADD(cohort_week, INTERVAL 4 week) THEN revenue
    END
      ) / COUNT(DISTINCT w.user_id), 4) AS week_4,
  ROUND(SUM(
      CASE
        WHEN purchase_week = DATE_ADD(cohort_week, INTERVAL 5 week) THEN revenue
    END
      ) / COUNT(DISTINCT w.user_id), 4) AS week_5,
  ROUND(SUM(
      CASE
        WHEN purchase_week = DATE_ADD(cohort_week, INTERVAL 6 week) THEN revenue
    END
      ) / COUNT(DISTINCT w.user_id), 4) AS week_6,
  ROUND(SUM(
      CASE
        WHEN purchase_week = DATE_ADD(cohort_week, INTERVAL 7 week) THEN revenue
    END
      ) / COUNT(DISTINCT w.user_id), 4) AS week_7,
  ROUND(SUM(
      CASE
        WHEN purchase_week = DATE_ADD(cohort_week, INTERVAL 8 week) THEN revenue
    END
      ) / COUNT(DISTINCT w.user_id), 4) AS week_8,
  ROUND(SUM(
      CASE
        WHEN purchase_week = DATE_ADD(cohort_week, INTERVAL 9 week) THEN revenue
    END
      ) / COUNT(DISTINCT w.user_id), 4) AS week_9,
  ROUND(SUM(
      CASE
        WHEN purchase_week = DATE_ADD(cohort_week, INTERVAL 10 week) THEN revenue
    END
      ) / COUNT(DISTINCT w.user_id), 4) AS week_10,
  ROUND(SUM(
      CASE
        WHEN purchase_week = DATE_ADD(cohort_week, INTERVAL 11 week) THEN revenue
    END
      ) / COUNT(DISTINCT w.user_id), 4) AS week_11,
  ROUND(SUM(
      CASE
        WHEN purchase_week = DATE_ADD(cohort_week, INTERVAL 12 week) THEN revenue
    END
      ) / COUNT(DISTINCT w.user_id), 4) AS week_12
FROM
  cohort_weeks AS w
LEFT JOIN
  sum_rev r
ON
  w.user_id = r.user_id
GROUP BY
  w.cohort_week
ORDER BY
  w.cohort_week
```
</details>

<details>
<summary><a href="https://console.cloud.google.com/bigquery?sq=147855269776:a9a7016a5d384587b29dedab17b22b67" target="_blank"> <img src="https://w7.pngwing.com/pngs/182/372/png-transparent-google-bigquery-hd-logo.png" alt="css3" width="20" height="20"/> </a>  RFM Analysis</summary>

---
> TASK: Calculate recency, frequency and money value and convert those values into R, F and M scores by using Quartiles, 1 to 4 values. In BigQuery, a function APPROX_QUANTILES is used to set the quartiles.
> You can check your results with rfm_value table and rfm_quantiles.
> Those tables contain intermediate calculations and are used in next steps(1 step: calculate RFM values, possible answer - rfm_value table, 2 step: calculate RFM quantiles from RFM values, possible answer - rfm_quantiles).
> 
```
fm AS ( --frequency and monetary
SELECT
CustomerID,
COUNT(DISTINCT(invoiceNo)) AS frequency,
DATE_TRUNC(MAX(InvoiceDate), DAY) AS last_purchase,
SUM(Quantity * UnitPrice) AS monetary
FROM
`tc-da-1.turing_data_analytics.rfm`
WHERE
(CustomerID IS NOT NULL
AND UnitPrice > 0
AND Quantity > 0)
AND InvoiceDate <= '2011-12-01'
GROUP BY
CustomerID),

--recency
rec AS (
SELECT
*,
DATE_DIFF(DATE('2011-12-01'), DATE(last_purchase), DAY) AS recency
FROM
fm),
q AS (
--All percentiles for MONETARY
SELECT
*,
b.percentiles[
OFFSET
(25)] AS m25,
b.percentiles[
OFFSET
(50)] AS m50,
b.percentiles[
OFFSET
(75)] AS m75,
b.percentiles[
OFFSET
(100)] AS m100,
--All percentiles for FREQUENCY
c.percentiles[
OFFSET
(25)] AS f25,
c.percentiles[
OFFSET
(50)] AS f50,
c.percentiles[
OFFSET
(75)] AS f75,
c.percentiles[
OFFSET
(100)] AS f100,
--All percentiles for RECENCY
d.percentiles[
OFFSET
(25)] AS r25,
d.percentiles[
OFFSET
(50)] AS r50,
d.percentiles[
OFFSET
(75)] AS r75,
d.percentiles[
OFFSET
(100)] AS r100
FROM
rec a,
(
SELECT
APPROX_QUANTILES(monetary, 100) percentiles
FROM
rec) b,
(
SELECT
APPROX_QUANTILES(frequency, 100) percentiles
FROM
rec) c,
(
SELECT
APPROX_QUANTILES(recency, 100) percentiles
FROM
rec) d ),
score AS (
SELECT
*,
CAST(ROUND((f_score + m_score) / 2, 0) AS INT64) AS fm_score
FROM (
SELECT
*,
CASE
WHEN monetary <= m25 THEN 1
WHEN monetary > m25
AND monetary <= m50 THEN 2
WHEN monetary <= m75 AND monetary > m50 THEN 3
WHEN monetary <= m100
AND monetary > m75 THEN 4
END
AS m_score,
CASE
WHEN frequency <= f25 THEN 1
WHEN frequency <= f50
AND frequency > f25 THEN 2
WHEN frequency <= f75 AND frequency > f50 THEN 3
WHEN frequency <= f100
AND frequency > f75 THEN 4
END
AS f_score,
--Recency scoring is reversed
CASE
WHEN recency <= r25 THEN 4
WHEN recency <= r50
AND recency > r25 THEN 3
WHEN recency <= r75 AND recency > r50 THEN 2
WHEN recency <= r100
AND recency > r75 THEN 1
END
AS r_score,
FROM
q))
SELECT
DISTINCT CustomerID,
recency,
frequency,
monetary,
r_score,
f_score,
m_score,
fm_score,
CASE
WHEN (r_score = 4 AND fm_score = 4) OR (r_score = 4 AND fm_score = 3) OR (r_score = 3 AND fm_score = 4) THEN 'Best Customers'
WHEN (r_score = 4
AND fm_score =3)
OR (r_score = 3
AND fm_score = 3) THEN 'Loyal Customers'
WHEN (m_score = 4 AND fm_score = 4) OR (m_score = 3 AND fm_score = 4) OR (m_score = 4 AND fm_score = 3) THEN 'Big Spenders'
WHEN (r_score = 4
AND fm_score = 1)
OR (r_score = 4
AND fm_score = 2)
OR (r_score = 3
AND fm_score = 3)
OR (r_score = 3
AND fm_score = 2)
OR (r_score = 3
AND fm_score = 1) THEN 'Recent Customers'
WHEN (r_score = 4 AND fm_score = 2) OR (r_score = 2 AND fm_score = 4) OR (r_score = 2 AND fm_score = 3) THEN 'Promising Customers'
WHEN (r_score = 1
AND fm_score = 4)
OR (r_score = 1
AND fm_score = 3)
OR (r_score = 2
AND fm_score = 2) THEN 'Cant Lose Them'
WHEN (r_score = 1 AND fm_score = 1) OR (r_score = 2 AND fm_score = 1) OR (r_score = 1 AND fm_score = 2) THEN 'Lost Customers'
END
AS rfm_segment
FROM
score
ORDER BY
CustomerID
```
</details>

<details>
<summary><a href="https://console.cloud.google.com/bigquery?sq=147855269776:48d186a982914ae4baab84fead5581aa&project=youtube-api-installation&ws=!1m4!1m3!8m2!1s147855269776!2s48d186a982914ae4baab84fead5581aa" target="_blank"> <img src="https://w7.pngwing.com/pngs/182/372/png-transparent-google-bigquery-hd-logo.png" alt="css3" width="20" height="20"/> </a>  Retention cohort analysis</summary>

---
> TASK: You should provide weekly subscriptions data that shows how many subscribers started their subscription in a particular week and how many remain active in the following 6 weeks.
> Your end result should show weekly retention cohorts for each week of data available in the dataset and their retention from week 0 to week 6.
> 
```
-- code to calculate subscriptions retention rate, %

WITH
  date_range AS (
  SELECT
    DATE('2020-11-01') AS start_date,
    DATE('2021-02-07') AS end_date ),
  cohort_weeks AS (
  SELECT
    DATE_TRUNC(subscription_start, WEEK) AS cohort_start_week,
    user_pseudo_id,
    CASE
      WHEN DATE_DIFF(COALESCE(subscription_end, DATE('2021-02-07')), subscription_start, WEEK) >= 0 THEN 1
    ELSE
    0
  END
    AS retained_week0_customers,
    CASE
      WHEN DATE_DIFF(COALESCE(subscription_end, DATE('2021-02-07')), subscription_start, WEEK) >= 1 THEN 1
    ELSE
    0
  END
    AS retained_week1_customers,
    CASE
      WHEN DATE_DIFF(COALESCE(subscription_end, DATE('2021-02-07')), subscription_start, WEEK) >= 2 THEN 1
    ELSE
    0
  END
    AS retained_week2_customers,
    CASE
      WHEN DATE_DIFF(COALESCE(subscription_end, DATE('2021-02-07')), subscription_start, WEEK) >= 3 THEN 1
    ELSE
    0
  END
    AS retained_week3_customers,
    CASE
      WHEN DATE_DIFF(COALESCE(subscription_end, DATE('2021-02-07')), subscription_start, WEEK) >= 4 THEN 1
    ELSE
    0
  END
    AS retained_week4_customers,
    CASE
      WHEN DATE_DIFF(COALESCE(subscription_end, DATE('2021-02-07')), subscription_start, WEEK) >= 5 THEN 1
    ELSE
    0
  END
    AS retained_week5_customers,
    CASE
      WHEN DATE_DIFF(COALESCE(subscription_end, DATE('2021-02-07')), subscription_start, WEEK) >= 6 THEN 1
    ELSE
    0
  END
    AS retained_week6_customers
  FROM
    `tc-da-1.turing_data_analytics.subscriptions` s
  RIGHT JOIN
    date_range AS d
  ON
    (s.subscription_start >= d.start_date
      AND s.subscription_start <= d.end_date) )
SELECT
  cohort_start_week,
  COUNT(DISTINCT user_pseudo_id) AS total_customers,
  ROUND(COUNT(DISTINCT
      CASE
        WHEN retained_week0_customers = 1 THEN user_pseudo_id
    END
      ) * 100.0 / COUNT(DISTINCT user_pseudo_id), 2) AS retained_week0_percent,
  ROUND(COUNT(DISTINCT
      CASE
        WHEN retained_week1_customers = 1 THEN user_pseudo_id
    END
      ) * 100.0 / COUNT(DISTINCT user_pseudo_id), 2) AS retained_week1_percent,
  ROUND(COUNT(DISTINCT
      CASE
        WHEN retained_week2_customers = 1 THEN user_pseudo_id
    END
      ) * 100.0 / COUNT(DISTINCT user_pseudo_id), 2) AS retained_week2_percent,
  ROUND(COUNT(DISTINCT
      CASE
        WHEN retained_week3_customers = 1 THEN user_pseudo_id
    END
      ) * 100.0 / COUNT(DISTINCT user_pseudo_id), 2) AS retained_week3_percent,
  ROUND(COUNT(DISTINCT
      CASE
        WHEN retained_week4_customers = 1 THEN user_pseudo_id
    END
      ) * 100.0 / COUNT(DISTINCT user_pseudo_id), 2) AS retained_week4_percent,
  ROUND(COUNT(DISTINCT
      CASE
        WHEN retained_week5_customers = 1 THEN user_pseudo_id
    END
      ) * 100.0 / COUNT(DISTINCT user_pseudo_id), 2) AS retained_week5_percent,
  ROUND(COUNT(DISTINCT
      CASE
        WHEN retained_week6_customers = 1 THEN user_pseudo_id
    END
      ) * 100.0 / COUNT(DISTINCT user_pseudo_id), 2) AS retained_week6_percent
FROM
  cohort_weeks
GROUP BY
  cohort_start_week;

  -- code to calculate retained subscriptions purchases without percentage
  WITH date_range AS (
  SELECT
    DATE('2020-11-01') AS start_date,
    DATE('2021-02-07') AS end_date
),
cohort_weeks AS (
  SELECT
    DATE_TRUNC(subscription_start, WEEK) AS cohort_start_week,
    user_pseudo_id,
    CASE
      WHEN DATE_DIFF(COALESCE(subscription_end, DATE('2021-02-07')), subscription_start, WEEK) >= 0 THEN 1
      ELSE 0
    END AS retained_week0_customers,
    CASE
      WHEN DATE_DIFF(COALESCE(subscription_end, DATE('2021-02-07')), subscription_start, WEEK) >= 1 THEN 1
      ELSE 0
    END AS retained_week1_customers,
    CASE
      WHEN DATE_DIFF(COALESCE(subscription_end, DATE('2021-02-07')), subscription_start, WEEK) >= 2 THEN 1
      ELSE 0
    END AS retained_week2_customers,
    CASE
      WHEN DATE_DIFF(COALESCE(subscription_end, DATE('2021-02-07')), subscription_start, WEEK) >= 3 THEN 1
      ELSE 0
    END AS retained_week3_customers,
    CASE
      WHEN DATE_DIFF(COALESCE(subscription_end, DATE('2021-02-07')), subscription_start, WEEK) >= 4 THEN 1
      ELSE 0
    END AS retained_week4_customers,
    CASE
      WHEN DATE_DIFF(COALESCE(subscription_end, DATE('2021-02-07')), subscription_start, WEEK) >= 5 THEN 1
      ELSE 0
    END AS retained_week5_customers,
    CASE
      WHEN DATE_DIFF(COALESCE(subscription_end, DATE('2021-02-07')), subscription_start, WEEK) >= 6 THEN 1
      ELSE 0
    END AS retained_week6_customers
  FROM
    `tc-da-1.turing_data_analytics.subscriptions` s
  RIGHT JOIN
    date_range AS d ON (s.subscription_start >= d.start_date AND s.subscription_start <= d.end_date)
)

SELECT
  cohort_start_week,
  COUNT(CASE WHEN retained_week0_customers = 1 THEN user_pseudo_id END) AS retained_week0_customers,
  COUNT(CASE WHEN retained_week1_customers = 1 THEN user_pseudo_id END) AS retained_week1_customers,
  COUNT(CASE WHEN retained_week2_customers = 1 THEN user_pseudo_id END) AS retained_week2_customers,
  COUNT(CASE WHEN retained_week3_customers = 1 THEN user_pseudo_id END) AS retained_week3_customers,
  COUNT(CASE WHEN retained_week4_customers = 1 THEN user_pseudo_id END) AS retained_week4_customers,
  COUNT(CASE WHEN retained_week5_customers = 1 THEN user_pseudo_id END) AS retained_week5_customers,
  COUNT(CASE WHEN retained_week6_customers = 1 THEN user_pseudo_id END) AS retained_week6_customers
FROM
  cohort_weeks
GROUP BY
  cohort_start_week;
```
</details>

<details>
<summary><a href="https://console.cloud.google.com/bigquery?sq=147855269776:1adcdf2dfe1c4c6b8780a2f7fc7a305b&project=youtube-api-installation&ws=!1m4!1m3!8m2!1s147855269776!2s1adcdf2dfe1c4c6b8780a2f7fc7a305b" target="_blank"> <img src="https://w7.pngwing.com/pngs/182/372/png-transparent-google-bigquery-hd-logo.png" alt="css3" width="20" height="20"/> </a>  Funnels & A/B Tests</summary>

---
> TASK: You should provide weekly subscriptions data that shows how many subscribers started their subscription in a particular week and how many remain active in the following 6 weeks.
> Your end result should show weekly retention cohorts for each week of data available in the dataset and their retention from week 0 to week 6.
> 
```
--unique users events
SELECT user_pseudo_id, MIN(event_timestamp) as first_event_timestamp, event_name, country
FROM `tc-da-1.turing_data_analytics.raw_events`
WHERE event_name in ('first_visit', 'view_item', 'add_to_cart' ,'begin_checkout', 'purchase')
GROUP BY 1,3,4;

-- full code
WITH top_countries AS (
  SELECT 
    country, 
    COUNT(event_timestamp) AS no_events,
    ROW_NUMBER() OVER (ORDER BY COUNT(event_timestamp) DESC) AS country_rank
  FROM 
    `tc-da-1.turing_data_analytics.raw_events`
  GROUP BY 
    country
),
users_events AS (
  SELECT 
    user_pseudo_id, 
    MIN(event_timestamp) AS first_event_timestamp, 
    event_name, 
    country
  FROM 
    `tc-da-1.turing_data_analytics.raw_events`
  WHERE 
    event_name IN ('first_visit', 'view_item', 'add_to_cart', 'begin_checkout', 'purchase')
  GROUP BY 
    1, 3, 4
),
event_ranks AS (
  SELECT
    event_name,
    CASE 
      WHEN event_name = 'first_visit' THEN 1
      WHEN event_name = 'view_item' THEN 2
      WHEN event_name = 'add_to_cart' THEN 3
      WHEN event_name = 'begin_checkout' THEN 4
      WHEN event_name = 'purchase' THEN 5
    END AS event_rank,
    country,
    COUNT(DISTINCT user_pseudo_id) AS no_users
  FROM 
    users_events
    GROUP BY 1,3
)
SELECT
  event_rank,
  event_name,
  MAX(CASE WHEN country_rank = 1 THEN no_users ELSE NULL END) AS country_1_no_users,
  MAX(CASE WHEN country_rank = 2 THEN no_users ELSE NULL END) AS country_2_no_users,
  MAX(CASE WHEN country_rank = 3 THEN no_users ELSE NULL END) AS country_3_no_users
FROM 
  event_ranks
LEFT JOIN 
  top_countries USING (country)
GROUP BY 
  event_rank, event_name
ORDER BY 
  event_rank;

--A/B testing
SELECT
  campaign,
  impressions,
  clicks
FROM
  `tc-da-1.turing_data_analytics.adsense_monthly`
WHERE
  campaign IN ('NewYear_V1',
    'NewYear_V2',
    'BlackFriday_V1',
    'BlackFriday_V2')
  AND Month<>202111;

  --FINAL SQL code to pull out test campaigns results
WITH
  converted_users AS (
  SELECT
    user_pseudo_id,
    campaign
  FROM
    `tc-da-1.turing_data_analytics.raw_events`
  WHERE
    event_name = 'page_view' )
SELECT
  cu.campaign,
  ad.Impressions,
  COUNT(DISTINCT(cu.user_pseudo_id)) AS converted_user_no,
  ad.Month
FROM
converted_users as cu
LEFT JOIN
  `tc-da-1.turing_data_analytics.adsense_monthly` AS ad
ON
  ad.Campaign = cu.campaign
WHERE
  ad.campaign IN ('NewYear_V1',
    'NewYear_V2',
    'BlackFriday_V1',
    'BlackFriday_V2')
  AND ad.Month<>202111
GROUP BY
  1,2,4
ORDER BY
  cu.campaign;
```
</details>
</details>
